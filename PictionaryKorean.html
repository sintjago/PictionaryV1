<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>픽셔너리 게임</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }

    .game-wrapper {
      width: 900px;
      margin: 0 auto;
    }

    .controls-row {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .controls-row button,
    .controls-row input {
      font-size: 14px;
      padding: 5px 8px;
    }

    .controls-row input[type="number"] {
      width: 45px;
      text-align: center;
    }

    #card-display {
      font-weight: bold;
      font-size: 18px;
      min-width: 80px;
      text-align: center;
    }

    #canvas-area {
      display: flex;
      gap: 20px;
    }

    canvas {
      border: 1px solid black;
      background-color: white;
    }

    #score-table {
      border-collapse: collapse;
      background-color: #eef;
      font-size: 14px;
      width: 200px;
      margin-bottom: 10px;
    }

    #score-table th, #score-table td {
      border: 1px solid #99c;
      padding: 5px 8px;
      text-align: center;
    }

    #score-table th {
      background-color: #cce;
    }

    .csv-input-area {
      display: flex;
      flex-direction: column;
      gap: 5px;
      width: 185px;
    }

    .csv-input-area input[type="text"],
    .csv-input-area input[type="color"],
    .csv-input-area input[type="range"] {
      width: 100%;
      padding: 5px;
      font-size: 14px;
    }

    .csv-input-area button {
      width: 80px;
    }

    .color-label, .thickness-label {
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <!-- 줄 1: 제목 + 단어 + 타이머 -->
    <div class="controls-row">
      <strong id="title">픽셔너리 그리기 게임</strong>
      <button class="speak-on-click" id="new-card-btn">새 단어</button>
      <span>그리기:</span>
      <span id="card-display">_ _ _</span>
      <button class="speak-on-click" id="discard-card-btn">건너뛰기</button>
      <button class="speak-on-click" id="start-timer">시작</button>
      <input type="number" id="timer" value="60" min="1"> 초
      <button class="speak-on-click" id="reset-timer">재설정</button>
    </div>

    <!-- 줄 2: 도형 + 초기화 + 게임 초기화 -->
    <div class="controls-row">
      <button class="speak-on-click" id="circle-btn">원</button>
      <button class="speak-on-click" id="triangle-btn">삼각형</button>
      <button class="speak-on-click" id="line-btn">선</button>
      <button class="speak-on-click" id="rectangle-btn">사각형</button>
      <button class="speak-on-click" id="pentagon-btn">오각형</button>
      <button class="speak-on-click" id="hexagon-btn">육각형</button>
      <label>크기: <input type="number" id="font-size" value="20" min="5" max="100"></label>
      <button class="speak-on-click" id="reset-canvas">초기화</button>
      <button class="speak-on-click" id="reset-whole-game">게임 초기화</button>
    </div>

    <!-- 캔버스와 오른쪽 사이드 패널 -->
    <div id="canvas-area">
      <canvas id="canvas" width="600" height="400"></canvas>

      <div>
        <table id="score-table">
          <thead>
            <tr><th>팀</th><th>점수</th></tr>
          </thead>
          <tbody>
            <tr><td contenteditable="true">팀 1</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 2</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 3</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 4</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 5</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 6</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 7</td><td contenteditable="true">0</td></tr>
            <tr><td contenteditable="true">팀 8</td><td contenteditable="true">0</td></tr>
          </tbody>
        </table>

        <div class="csv-input-area">
          <label for="csv-input">CSV 단어 목록:</label>
          <input type="text" id="csv-input" placeholder="강아지,바나나,고양이">
          <button class="speak-on-click" id="submit-csv">입력</button>

          <label for="color-picker" class="color-label">색상:</label>
          <input type="color" id="color-picker" value="#000000">

          <label for="pen-thickness" class="thickness-label">두께:</label>
          <input type="range" id="pen-thickness" min="1" max="10" value="2">
        </div>
      </div>
    </div>

    <!-- 설명 -->
    <div style="margin-top: 12px; font-size: 14px; max-width: 600px;">
      <strong>사용법:</strong><br>
      버튼을 눌러 도형을 그리거나 마우스로 자유롭게 그릴 수 있습니다.<br>
      도형을 더블클릭하면 삭제됩니다.<br>
      타이머로 턴 시간을 설정하세요. "새 단어"를 눌러 새 단어를 받으세요.<br>
      CSV 필드에 단어 목록을 붙여넣을 수도 있습니다.<br>
      아래에서 펜 색상과 두께를 선택하세요.
    </div>
<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;
  let shapes = [];
  let selectedShape = null;
  let freehandDrawing = false;
  let currentColor = "#000000";
  let currentThickness = 2;

  const colorPicker = document.getElementById("color-picker");
  const thicknessSlider = document.getElementById("pen-thickness");

  colorPicker.addEventListener("input", () => {
    currentColor = colorPicker.value;
  });

  thicknessSlider.addEventListener("input", () => {
    currentThickness = parseInt(thicknessSlider.value);
  });

  canvas.addEventListener('mousedown', (e) => handleMouseDown(e));
  canvas.addEventListener('mouseup', () => handleMouseUp());
  canvas.addEventListener('mousemove', (e) => handleMouseMove(e));
  canvas.addEventListener('dblclick', (e) => eraseShape(e));

  canvas.addEventListener('mousedown', () => freehandDrawing = true);
  canvas.addEventListener('mouseup', () => {
    freehandDrawing = false;
    ctx.beginPath();
  });
  canvas.addEventListener('mousemove', (e) => {
    if (freehandDrawing) draw(e);
  });

  function draw(e) {
    if (!freehandDrawing) return;
    ctx.lineWidth = currentThickness;
    ctx.lineCap = 'round';
    ctx.strokeStyle = currentColor;
    ctx.lineTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
  }

  function handleMouseDown(e) {
    const [x, y] = getMousePos(e);
    selectedShape = getShapeAtPosition(x, y);
    drawing = true;
  }

  function handleMouseUp() {
    drawing = false;
    selectedShape = null;
  }

  function handleMouseMove(e) {
    if (!drawing || !selectedShape) return;
    const [x, y] = getMousePos(e);
    selectedShape.x = x;
    selectedShape.y = y;
    drawCanvas();
  }

  function getMousePos(e) {
    return [e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop];
  }

  function getShapeAtPosition(x, y) {
    return shapes.find(shape => shape.isInside(x, y));
  }

  function drawCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    shapes.forEach(shape => shape.draw());
  }

  function eraseShape(e) {
    const [x, y] = getMousePos(e);
    const index = shapes.findIndex(shape => shape.isInside(x, y));
    if (index !== -1) {
      shapes.splice(index, 1);
      drawCanvas();
    }
  }

  class Shape {
    constructor(x, y, size, color) {
      this.x = x;
      this.y = y;
      this.size = size;
      this.color = color;
    }
    draw() {}
    isInside() { return false; }
  }

  class Circle extends Shape {
    draw() {
      ctx.beginPath();
      ctx.strokeStyle = this.color;
      ctx.lineWidth = currentThickness;
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.stroke();
    }
    isInside(x, y) {
      return Math.hypot(this.x - x, this.y - y) <= this.size;
    }
  }

  class Triangle extends Shape {
    draw() {
      ctx.beginPath();
      ctx.strokeStyle = this.color;
      ctx.lineWidth = currentThickness;
      ctx.moveTo(this.x, this.y - this.size);
      ctx.lineTo(this.x - this.size, this.y + this.size);
      ctx.lineTo(this.x + this.size, this.y + this.size);
      ctx.closePath();
      ctx.stroke();
    }
    isInside(x, y) {
      return x > this.x - this.size && x < this.x + this.size &&
             y > this.y - this.size && y < this.y + this.size;
    }
  }

  class Line extends Shape {
    draw() {
      ctx.beginPath();
      ctx.strokeStyle = this.color;
      ctx.lineWidth = currentThickness;
      ctx.moveTo(this.x - this.size, this.y);
      ctx.lineTo(this.x + this.size, this.y);
      ctx.stroke();
    }
    isInside(x, y) {
      return x >= this.x - this.size && x <= this.x + this.size &&
             y >= this.y - 5 && y <= this.y + 5;
    }
  }

  class Rectangle extends Shape {
    draw() {
      ctx.strokeStyle = this.color;
      ctx.lineWidth = currentThickness;
      ctx.strokeRect(this.x - this.size, this.y - this.size, this.size * 2, this.size * 1.5);
    }
    isInside(x, y) {
      return x >= this.x - this.size && x <= this.x + this.size &&
             y >= this.y - this.size && y <= this.y + this.size * 1.5;
    }
  }

  class Pentagon extends Shape {
    draw() {
      const angle = Math.PI * 2 / 5;
      ctx.beginPath();
      ctx.strokeStyle = this.color;
      ctx.lineWidth = currentThickness;
      for (let i = 0; i < 5; i++) {
        const x = this.x + this.size * Math.cos(angle * i - Math.PI / 2);
        const y = this.y + this.size * Math.sin(angle * i - Math.PI / 2);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.stroke();
    }
    isInside(x, y) {
      return Math.hypot(this.x - x, this.y - y) <= this.size;
    }
  }

  class Hexagon extends Shape {
    draw() {
      const angle = Math.PI / 3;
      ctx.beginPath();
      ctx.strokeStyle = this.color;
      ctx.lineWidth = currentThickness;
      for (let i = 0; i < 6; i++) {
        const x = this.x + this.size * Math.cos(angle * i);
        const y = this.y + this.size * Math.sin(angle * i);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.stroke();
    }
    isInside(x, y) {
      return Math.hypot(this.x - x, this.y - y) <= this.size;
    }
  }

  function addShape(ShapeType) {
    const size = parseInt(document.getElementById('font-size').value);
    const x = canvas.width / 2;
    const y = canvas.height / 2;
    const shape = new ShapeType(x, y, size, currentColor);
    shapes.push(shape);
    drawCanvas();
  }

  document.querySelectorAll('.speak-on-click').forEach(btn => {
    btn.addEventListener('click', () => {
      speak(btn.innerText);
    });
  });

  function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'ko-KR';
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(utter), 100);
  }

  document.getElementById('circle-btn').addEventListener('click', () => addShape(Circle));
  document.getElementById('triangle-btn').addEventListener('click', () => addShape(Triangle));
  document.getElementById('line-btn').addEventListener('click', () => addShape(Line));
  document.getElementById('rectangle-btn').addEventListener('click', () => addShape(Rectangle));
  document.getElementById('pentagon-btn').addEventListener('click', () => addShape(Pentagon));
  document.getElementById('hexagon-btn').addEventListener('click', () => addShape(Hexagon));

  document.getElementById('reset-canvas').addEventListener('click', () => {
    shapes = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });
</script>
<script>
  let timer;
  let timeLeft = 60;

  document.getElementById('start-timer').addEventListener('click', () => {
    clearInterval(timer);
    timeLeft = parseInt(document.getElementById('timer').value) || 60;
    document.getElementById('timer').value = timeLeft;
    timer = setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        document.getElementById('timer').value = timeLeft;
      } else {
        clearInterval(timer);
        alert("시간 종료!");
      }
    }, 1000);
  });

  document.getElementById('reset-timer').addEventListener('click', () => {
    clearInterval(timer);
    document.getElementById('timer').value = 60;
  });

  const deck = [
    "사과", "집", "강아지", "고양이", "자동차", "나무", "태양", "달", "별", "물고기",
    "새", "컴퓨터", "전화기", "기타", "케이크", "모자", "신발", "의자", "배", "비행기",
    "산", "강", "구름", "책", "꽃", "공", "로봇", "열쇠", "시계", "지도",
    "뱀", "자전거", "다리", "코끼리", "사자", "호랑이", "거미", "벌레", "컵", "연필",
    "하트", "카메라", "램프", "깃발", "창문", "문", "손", "발", "우산", "로켓"
  ];

  let currentCardIndex = -1;

  function speakWord(word) {
    const utter = new SpeechSynthesisUtterance(word);
    utter.lang = "ko-KR";
    speechSynthesis.cancel();
    setTimeout(() => speechSynthesis.speak(utter), 100);
  }

  document.getElementById('new-card-btn').addEventListener('click', () => {
    currentCardIndex = Math.floor(Math.random() * deck.length);
    const word = deck[currentCardIndex];
    document.getElementById('card-display').innerText = word;
    speakWord(word);
  });

  document.getElementById('discard-card-btn').addEventListener('click', () => {
    document.getElementById('card-display').innerText = "다음 단어!";
    currentCardIndex = -1;
  });

  document.getElementById('reset-whole-game').addEventListener('click', () => {
    shapes = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    clearInterval(timer);
    document.getElementById('timer').value = 60;
    currentCardIndex = -1;
    document.getElementById('card-display').innerText = "_ _ _";
    document.querySelectorAll("#score-table tbody tr").forEach(row => {
      row.cells[1].innerText = "0";
    });
  });

  document.getElementById('submit-csv').addEventListener('click', () => {
    const inputField = document.getElementById('csv-input');
    const input = inputField.value.trim();
    if (input) {
      const newDeck = input.split(',').map(word => word.trim()).filter(word => word);
      if (newDeck.length > 0) {
        deck.length = 0;
        deck.push(...newDeck);
        document.getElementById('card-display').innerText = "_ _ _";
        inputField.value = "";
        speak("목록이 업데이트되었습니다");
      } else {
        alert("CSV 목록에는 적어도 하나의 유효한 단어가 있어야 합니다.");
      }
    } else {
      alert("쉼표로 구분된 단어 목록을 입력하세요.");
    }
  });
</script>
</body>
</html>
